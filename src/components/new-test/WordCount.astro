---
// src/components/new-test/WordCount.astro
// 1. 定义组件接收的Props（参数），使其更灵活
export interface Props {
  /** 要统计的集合名称，默认为 'blog' */
  collectionName?: string;
  /** 自定义显示模板， {count} 会被替换为数字 */
  template?: string;
}

// 2. 设置Props的默认值
const {
  collectionName = 'blog',
  template = '全站总字数：{count}'
} = Astro.props;

// 3. 核心统计逻辑
import { getCollection } from 'astro:content';
let totalWords = 0;

try {
  // 获取指定集合的所有文章
  const allPosts = await getCollection(collectionName);
  
  for (const post of allPosts) {
    const content = post.body; // Astro提供的纯文本内容
    if (content) {
      // 同时统计中文字符和英文单词
      const chineseChars = content.match(/[\u4e00-\u9fa5]/g) || [];
      const englishWords = content.match(/\b[a-zA-Z]+\b/g) || [];
      totalWords += chineseChars.length + englishWords.length;
    }
  }
} catch (error) {
  console.error('统计字数时出错：', error);
  totalWords = 0;
}

// 4. 替换模板中的占位符
const displayText = template.replace('{count}', totalWords.toLocaleString());
---

<!-- 5. 渲染结果 -->
<span class="word-count-text">
  {displayText}
</span>
