---
// src/components/new-test/WordCount.astro
// 1. 定义组件接收的Props（参数），使其更灵活
export interface Props {
  /** 要统计的集合名称，默认为 'blog' */
  collectionName?: string;
  /** 自定义显示模板， {count} 会被替换为数字 */
  template?: string;
}

// 2. 设置Props的默认值
const {
  collectionName = 'blog',
  template = '全站总字数：{count}'
} = Astro.props;

// 3. 核心统计逻辑
import { getCollection } from 'astro:content';
let totalWords = 0;

try {
  // 获取指定集合的所有文章
  const allPosts = await getCollection(collectionName as "blog");
  
  for (const post of allPosts) {
    const content = post.body; // Astro提供的纯文本内容
    if (content) {
      // 同时统计中文字符和英文单词
      const chineseChars = content.match(/[\u4e00-\u9fa5]/g) || [];
      const englishWords = content.match(/\b[a-zA-Z]+\b/g) || [];
      totalWords += chineseChars.length + englishWords.length;
    }
  }
} catch (error) {
  console.error('统计字数时出错：', error);
  totalWords = 0;
}

// 4. 替换模板中的占位符
const displayText = template.replace('{count}', totalWords.toString());
---

<!-- 5. 渲染结果 -->

<span class="word-count-text">
  <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 32 32"><rect width="32" height="32" fill="none"/><path fill="currentColor" d="M25 12h-5v2h5a1 1 0 0 1 1 1v2h-4a3.003 3.003 0 0 0-3 3v1a3.003 3.003 0 0 0 3 3h6v-9a3.003 3.003 0 0 0-3-3m-3 10a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h4v3zm-6 2h2L12 7h-2L4 24h2l1.694-5h6.613zm-7.629-7l2.497-7.371h.266L13.63 17z"/></svg> --> {displayText}
</span>
