---
import { SITE_MENU, USER_AVATAR, USER_SIDEBAR_SOCIAL_ICONS } from "../../config";
import { Icon } from "astro-icon/components";
import Card from "../temple/Card.astro";
import { Image } from "astro:assets";

const currentPath = Astro.url.pathname;
---

<Card>
  <div class="p-2 flex justify-center">
  <!-- 外层容器：大小由头像决定，但需要限制在合理范围内 -->
  <div class="relative inline-block max-w-[250px] max-h-[250px] w-full h-auto">
    <!-- 底层：原始头像 -->
    <Image
      class="w-full h-auto rounded-full"
      format="webp"
      width={250}
      height={250}
      src={USER_AVATAR}
      alt="Profile"
      loading="eager"
    />
    <!-- 上层：头像框图片 -->
    <img
      id="christmas-frame"
      src="/Christmas.png"
      alt="圣诞节头像框"
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 scale-[1.5] pointer-events-none z-10 hidden"
    />
  </div>
  </div>
    <ul class="menu bg-transparent w-full m-0 p-0 hidden md:flex flex-col items-center lg:items-start">
      {
        SITE_MENU.map((item) => (
          <li class="w-full relative group">
            {item.subItems ? (
              <details class="menu-item w-full" data-submenu-id={item.id} open={currentPath.startsWith(item.href)}>
                <summary class="justify-center lg:justify-start items-center text-center text-xl md:text-3xl lg:text-xl font-bold p-4 hover:bg-base-200 rounded-lg">
                  <Icon name={item.svg} />
                  <span class="hidden lg:inline ml-2">{item.text}</span>
                </summary>
                <ul class="rounded-lg">
                  {item.subItems.map((subItem) => (
                    <li class="relative">
                      <a
                        tabindex="0"
                        class="menu-item text-base md:text-2xl lg:text-base font-bold p-2 hover:bg-base-200 rounded-lg"
                        id={`header-${subItem.id}`}
                        href={subItem.href}
                        target={subItem.target || "_self"}
                        aria-label={subItem.text}
                      >
                        <Icon name={subItem.svg} />
                        <span class="hidden lg:inline ml-2">{subItem.text}</span>
                      </a>
                    </li>
                  ))}
                </ul>
              </details>
            ) : (
              <a
                tabindex="0"
                class="flex justify-center lg:justify-start items-center text-center text-xl md:text-3xl lg:text-xl font-bold p-4 hover:bg-base-200 rounded-lg"
                id={item.id}
                href={item.href}
                target={item.target || "_self"}
                aria-label={item.text}
              >
                <Icon name={item.svg} />
                <span class="hidden lg:inline ml-2">{item.text}</span>
              </a>
            )}
          </li>
        ))
      }
    </ul>

    <!-- Social Icons -->
    <div class="mt-4 pt-3 border-t border-base-content/20">
      <div class="grid grid-cols-4 md:grid-cols-2 lg:grid-cols-4 gap-2 justify-items-center">
        {
          USER_SIDEBAR_SOCIAL_ICONS.map((icon) => (
            <div class="tooltip tooltip-bottom" data-tip={icon.title}>
              <a
                tabindex="0"
                href={icon.href}
                aria-label={icon.ariaLabel}
                target="_blank"
                class="btn btn-circle btn-ghost"
              >
                <Icon name={icon.svg} class="text-xl" />
              </a>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</Card>

<script>
// 客户端JavaScript：在浏览器中判断是否为圣诞节期间
function isChristmasSeason() {
  const now = new Date();
  const month = now.getMonth() + 1; // 月份 (0-11) 转为 (1-12)
  const day = now.getDate();
  
  // 判断是否为12月，并且日期在22-28日之间
  return month === 12 && day >= 22 && day <= 28;
}

// 页面加载后检查
document.addEventListener('DOMContentLoaded', () => {
  if (isChristmasSeason()) {
    const frame = document.getElementById('christmas-frame');
    if (frame) {
      frame.classList.remove('hidden');
    }
  }
});

// 如果是单页应用，还需要监听页面切换
document.addEventListener('astro:page-load', () => {
  if (isChristmasSeason()) {
    const frame = document.getElementById('christmas-frame');
    if (frame) {
      frame.classList.remove('hidden');
    }
  }
});
</script>